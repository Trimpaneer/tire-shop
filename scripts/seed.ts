import { PrismaClient } from '@prisma/client';
import { products } from '../lib/data';
import bcrypt from 'bcryptjs';

const prisma = new PrismaClient();

async function main() {
    console.log('Start seeding ...');

    // 1. Create Admin User
    const adminEmail = 'nicolaparmentie@gmail.com';
    const adminPassword = await bcrypt.hash('tructruc', 10);

    const admin = await prisma.user.upsert({
        where: { email: adminEmail },
        update: {
            password: adminPassword,
            role: 'ADMIN',
        },
        create: {
            email: adminEmail,
            password: adminPassword,
            role: 'ADMIN',
        },
    });

    console.log(`Admin user created/updated: ${admin.email}`);

    // 2. Seed Products with actual stock quantities
    // Stock mapping from user-provided data
    const stockMap: Record<string, number> = {
        "15512RW": 2, "5.513KU": 4, "1656513IL": 13, "1656513PT": 12, "1656513RW": 6,
        "1657013DM": 1, "1657013GA": 22, "1657013KU": 4, "1657013GY": 4, "1657013RW": 2,
        "1757013RW": 6, "1757013KU": 10, "1757013GY": 6, "1757013IL3": 44, "1856013IL1": 2,
        "1856013KU": 6, "1857013WL": 1, "1857013KU": 11, "1857013GY": 4, "278.514IL": 4,
        "278.514NA": 2, "1656014KU": 4, "1656514DE": 1, "1656514IL": 16, "1656514RW": 3,
        "1656514KU": 4, "1656514GY": 10, "1657014GA": 2, "1657014KU": 2, "1657014RW": 4,
        "1657014KU2": 4, "1756514GA": 2, "1756514KU": 2, "1756514BO": 1, "1756514GY": 4,
        "1756514RW": 4, "1757014RW": 2, "1757014GA": 4, "1757014RW2": 4, "1757014KU": 4,
        "17514HF": 2, "1855514RW": 4, "1856014KU": 2, "1856014IL1": 44, "1856014KU2": 20,
        "1856014RW": 6, "1856014GY": 8, "1856014DM": 20, "1856514IL1": 1, "1856514IL2": 40,
        "1856514RW": 4, "1856514KU": 18, "1856514RY": 9, "1856514GY": 8, "1857014IL": 26,
        "1857014KU": 4, "1857014BO": 1, "18514BO": 4, "18514RW": 4, "1956014KU": 2,
        "1957014TR": 1, "1957014KU": 4, "1958014GY": 2, "19514KU": 4, "19514GA": 8,
        "19514BO": 8, "19514HK": 4, "19514RW": 2, "2056014NK": 4, "2157514BO": 5,
        "2157514GY": 4, "715SP": 6, "715VK": 4, "3110.515FJ": 2, "3110.515TR": 1,
        "3110.515IL2": 30, "3110.515RW2": 4, "3110.515GY": 4, "3110.515IL1": 43, "1854515NK": 2,
        "1855515RW": 4, "1855515IL": 14, "1855515MI": 2, "1856015KU": 4, "1856515HF": 19,
        "1856515IL1": 3, "1856515RW": 3, "1856515KU": 11, "1856515IL3": 28, "1856515GY2": 23,
        "1954515KU": 4, "1955015KU": 4, "1955515KU": 8, "1955515RW": 6, "1955515DM": 1,
        "1955515PRO": 10, "1955515GY": 4, "1955515MI": 4, "1956015MI": 4, "1956015KU": 4,
        "1956515BO": 2, "1956515RW": 4, "1956515KU": 6, "1956515GY": 4, "1956515MI": 4,
        "1957015KU2": 8, "1957015GY": 2, "1957015IL": 12, "1957015BO": 6, "1957015RW": 4,
        "1957015MI": 1, "1958015BR": 40, "1958015DU": 8, "19515IL": 12, "19515GY": 10,
        "2055515RW": 4, "2056015GY": 4, "2056015BO": 2, "2056015KU": 4, "2056515LL": 7,
        "2056515KU": 4, "2056515BO": 5, "2057015RB": 6, "2057015FO": 3, "2057015IL": 10,
        "2057015IL2": 42, "2057015RW": 4, "2057015GY": 2, "2057015MI": 2, "2057515NK": 4,
        "2057515RB": 2, "2157015IL": 4, "2157015MI": 2, "2157015GY": 4, "2157515RW": 6,
        "2157515HF": 2, "2157515GY": 4, "2257015RW": 2, "2257015RW2": 2, "2257015GY": 4,
        "2257015MI": 4, "2257015FO": 2, "2357515RW2": 16, "2357515RW": 8, "2357515GY3": 8,
        "2357515DM": 16, "2357515IL2": 4, "2357515KU": 6, "2357515SP": 3, "2357515KU2": 4,
        "2556015KU": 4, "2557015IL": 32, "2756015KU2": 4, "2955015KU": 4, "7R16AO": 2,
        "7R16ST2": 6, "7.516BF": 1, "IL7.516": 14, "7.516BO": 2, "1856016KU": 4,
        "1955016IL": 7, "1955016MI": 4, "1955516GY": 4, "1955516RW": 2, "1955516KU": 4,
        "1956016KU": 8, "1956016ZC": 4, "1957516GY": 4, "1957516MI": 4, "1957516RW": 4,
        "1957516KU": 4, "2054516KU2": 4, "2054516KU": 2, "2055016GY": 4, "2055016GA": 2,
        "2055516RW": 4, "2055516IL2": 9, "2055516KU2": 4, "2055516GY2": 10, "2055516MI2": 6,
        "2056016KU": 6, "2056016FO": 8, "2056016MI2": 4, "2056016RW": 8, "2056516RW": 4,
        "2057016KU": 4, "2057516FU": 2, "2057516MI": 4, "2057516RW": 2, "20516BR": 10,
        "20516FO": 1, "2155516LF": 2, "2155516MI": 6, "2156016SP": 4, "2156016KU": 4,
        "2156016GY": 4, "2156516KU": 6, "2156516GY": 4, "2156516IL": 21, "2156516MI": 4,
        "2156516RW": 4, "2157016RW": 4, "2157516RW": 4, "2157516GA": 6, "2157516KU": 2,
        "2255516KU2": 4, "2256016MI": 2, "2257016RW": 4, "2257016KU": 4, "2257516RW2": 4,
        "2257516HK3": 4, "2257516MI": 2, "2257516IL": 14, "2257516GY2": 2, "2356016RW": 2,
        "2356016KU": 4, "2356016GY": 4, "2356016NK": 2, "2356516KU": 4, "2357016RW": 4,
        "2457016RW": 8, "2457516FJ": 1, "2457516KU1": 1, "2457516IL2": 6, "2457516IL1": 10,
        "2457516RW2": 4, "2457516KU3": 2, "2457516RW": 6, "2457516KU2": 2, "2557016IL1": 18,
        "2557016FJ": 4, "2557016KU3": 2, "2557016GY": 22, "2557016MI1": 4, "2657016GY2": 4,
        "2657016RW": 4, "2657016KU": 2, "2657016GY": 4, "2657016GA": 4, "2657016MI1": 4,
        "2657516RW": 4, "2657516GA": 4, "2657516BO": 4, "2657516KU": 4, "2756016HK": 6,
        "2757016RW": 4, "2054017SP": 4, "2054517BF": 1, "2054517SP": 4, "2054517ZC": 4,
        "2054517NK": 4, "2055017KU2": 4, "2055017NK": 4, "2055017FU": 4, "2055517BO": 4,
        "2055517BF": 4, "2055517GY": 6, "2154517GY": 4, "2154517KU2": 4, "2154517KU": 2,
        "2154517SP": 4, "2155017KU": 4, "2155017BO": 4, "2155017GA": 2, "2155517SP": 3,
        "2155517GA": 4, "2155517KU": 4, "2155517MI": 2, "2156017AP": 2, "2156017IL": 15,
        "2156017GY": 2, "2156017MI": 4, "2156017DU": 4, "2156017KU": 4, "2254517KU": 4,
        "2254517GY": 4, "2254517SP": 4, "2255017FR": 2, "2255017KU": 6, "2255517KU": 4,
        "2256017RW": 2, "2256017KU": 8, "2256017KU3": 1, "2256017GY": 4, "2256017MI": 4,
        "2256017RW2": 4, "2256517BO": 2, "2256517GY": 2, "2256517RW": 4, "2256517KU": 4,
        "2256517MI2": 2, "2256517MI": 4, "2355517KU": 6, "2355517RW": 4, "2356017RW": 8,
        "2356017IL": 18, "2356017KU": 6, "2356017MI2": 4, "2356517RW": 4, "2356517FU": 2,
        "2356517KU2": 4, "2454517GY": 12, "2456517RW": 4, "2457017RW": 4, "2656517BR": 10,
        "2656517GY": 6, "2656517IL2": 7, "2656517DE": 2, "2656517RW2": 2, "2657017GY": 4,
        "2657017RW": 4, "2657017RX": 4, "2756017HK": 4, "2155518MI": 4, "2155518KU2": 4,
        "2155518RW": 10, "2155518KU": 1, "2254518GA": 4, "2254518GY": 4, "2254518MI": 1,
        "2254518KU": 4, "2254518SP": 4, "2255018KU": 2, "2255018BR": 18, "2255518EC": 4,
        "2255518KU": 6, "2256018KU": 4, "2256018RW2": 2, "2256018RW": 4, "2355018KU": 4,
        "2355018SP": 4, "2355518GA": 4, "2355518KU": 4, "2356018RW": 4, "2356018KU": 4,
        "2454518KU": 4, "2455018GY": 2, "2456018RW": 4, "2456018KU": 4, "2556018KU": 2,
        "2656018HK2": 2, "2656018IL": 16, "2656018ZC": 1, "2656018RW": 4, "2656018KU": 2,
        "2656018GY2": 4, "2656018RW2": 4, "2656018MI2": 2, "2656018GY": 4, "2656518YO": 4,
        "2756518KU": 4, "2756518RW": 4, "2254519RW": 4, "2254519KU": 4, "2255519SP": 2,
        "2255519KU2": 4, "2255519MI": 4, "2355019KU": 5, "2355519GA": 4, "2355519HF": 4,
        "2355519KU": 4, "2454519KU": 2, "2454519KU2": 4, "2555519GY": 4, "2454520KU": 4,
        "2555020KU": 2, "2555020GA": 4, "2555020GY": 2, "2555520KU": 4, "2655020BO": 4,
        "2656020YO": 4, "2754520IL": 8, "2755520KU": 4, "2855020SP": 4
    };

    // We'll use upsert to avoid duplicates and allow re-seeding
    let count = 0;
    for (const product of products) {
        // Get actual stock quantity from mapping, default to 0 if not found
        const actualStock = stockMap[product.id] || 0;

        await prisma.product.upsert({
            where: { id: product.id },
            update: {
                reference: product.id, // Use ID as reference
                name: product.name,
                brand: product.brand,
                size: product.size,
                price: product.price,
                vehicleType: product.vehicleType,
                stock: actualStock, // Use actual stock quantity
            },
            create: {
                id: product.id,
                reference: product.id, // Use ID as reference
                name: product.name,
                brand: product.brand,
                size: product.size,
                price: product.price,
                vehicleType: product.vehicleType,
                stock: actualStock, // Use actual stock quantity
                stockMovements: {
                    create: {
                        quantity: actualStock,
                        type: 'IN',
                        reason: 'Initial Seed',
                    },
                },
            },
        });
        count++;
        if (count % 100 === 0) {
            console.log(`Processed ${count} products...`);
        }
    }

    console.log(`Seeding finished. Processed ${count} products.`);
}

main()
    .then(async () => {
        await prisma.$disconnect();
    })
    .catch(async (e) => {
        console.error(e);
        await prisma.$disconnect();
        process.exit(1);
    });
